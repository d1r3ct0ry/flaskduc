<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Frete - Duc Entregas</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <style>
    body, html {
      height: 100%;
      font-family: 'Poppins', sans-serif;
      background-color: rgb(255, 130, 53); /* Fundo laranja */
    }
    .container {
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding-top: 60px; /* Espaço para a tarja */
      background-color: white; /* Fundo branco para o conteúdo */
      width: 100%; /* Para ocupar toda a largura */
    }
    .logo {
      width: 213px;
      margin-bottom: 20px;
    }
    .top-banner {
      background-color: rgb(255, 130, 53);
      height: 60px; /* Altura da tarja */
      width: 100%;
      position: fixed; /* Fixa a tarja na parte superior */
      top: 0;
      left: 0;
      display: flex;
      align-items: center; /* Centraliza verticalmente */
      justify-content: center; /* Centraliza horizontalmente */
      color: white; /* Cor do texto */
      font-weight: bold; /* Estilo do texto */
      z-index: 1000; /* Garante que a tarja fique acima do conteúdo */
    }
    .btn-custom-orange {
      background-color: rgb(255, 130, 53);
      color: white;
      border: none;
      font-weight: bold;
      height: 40px;
      font-size: 16px;
      width: 100%;
    }
    .btn-custom-orange:hover {
      background-color: rgb(230, 115, 47);
    }
    .margin-top-custom {
      margin-top: 20px;
    }
    .form-control {
      text-align: center;
      font-size: 14px;
      height: 40px;
      width: 300px;
    }
    .form-control::placeholder {
      font-size: 14px;
      color: #aaa;
    }
    .desconto-texto {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .hidden {
      display: none;
    }
    .visible {
      display: block;
    }
    .form-group.row {
      display: flex;
      justify-content: space-between;
    }
    .terceira-tela-header {
      font-weight: bold;
      font-size: 22px;
      margin-bottom: 15px;
    }
    .form-check {
      margin-top: 15px;
    }
    .btn {
      width: 100%;
    }
    .btn-link {
      width: auto;
      color: rgb(255, 130, 53);
    }
    #segundaTela {
      padding: 20px;
    }
    .whatsapp-float {
      position: fixed;
      bottom: 20px;
      right: 20px; /* valor padrão para mobile */
      background-color: #25d366;
      color: white;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      transition: background-color 0.3s;
    }
    
    /* Para desktop: alinha dentro da "container" branca */
    @media (min-width: 768px) {
      .whatsapp-float {
        right: calc(50% - 300px + 20px); /* 50% da tela - metade da largura da .container + um espaçamento */
      }
    }
    
    .whatsapp-float:hover {
      background-color: #1ebe5b;
      color: white;
    }
    
    .destaque-lojista {
      font-size: 32px;
      font-weight: bold;
      color: #ff6600; /* Laranja vibrante */
      text-transform: uppercase;
      letter-spacing: 1px;
    }

  </style>
</head>
<a href="https://api.whatsapp.com/send?phone=5521966904641" target="_blank" class="whatsapp-float">
  <i class="fab fa-whatsapp"></i>
</a>
<body>

  <div class="container">
    <!-- Primeira tela -->
    <div id="primeiraTela" class="text-center">
      <img src="/assets/logo.png" alt="Logo" class="logo">
      
      <div class="desconto-texto">
        <span class="destaque-lojista">Lojista</span><br>
      </div>
      
      <div class="desconto-texto">
        Descubra o valor da Entrega<br> com um clique.
      </div>
    
      <div class="form-group mb-4">
        <input type="text" class="form-control" id="cep" placeholder="Digite seu CEP" maxlength="9" oninput="formatarCep(this)">
      </div>
    
      <button class="btn btn-custom-orange btn-block mb-2" onclick="buscarCep()">
        <i class="fas fa-calculator"></i> Calcular
      </button>
      <button class="btn btn-link mt-2" onclick="enviarMensagemWhatsApp()">Não sei meu CEP</button>
    </div>
    
    <!-- Segunda tela: resultado do frete -->
    <div id="segundaTela" class="hidden text-center">
      <p style="margin-bottom: 20px;">O valor do seu frete é: <strong id="valorFrete"></strong></p>
      <p style="margin-bottom: 20px;"><strong>Endereço:</strong> <span id="endereco"></span></p>
        
      <div class="form-group mb-2 d-flex justify-content-center">
        <input type="text" class="form-control mr-2" id="numero" placeholder="Número" required style="width: 100px; text-align: center;">
        <input type="text" class="form-control" id="complemento" placeholder="Complemento" style="width: 200px;">
      </div>
        
      <div class="form-check mb-2 d-flex align-items-center" style="margin-left: 120px;">
        <input type="checkbox" class="form-check-input" id="semComplemento" onclick="toggleComplemento()" style="margin-top: 0;">
        <label class="form-check-label" for="semComplemento" style="font-size: 0.9em; margin-left: 5px; font-weight: bold;">Não tenho</label>
      </div>
        
      <div class="form-group mb-2">
        <input type="text" class="form-control" id="pontoReferencia" placeholder="Ponto de Referência" style="width: 300px; margin: 0 auto;">
      </div>
        
      <button class="btn btn-primary btn-block mb-2" style="height: 40px; width: 300px; margin: 0 auto; font-weight: bold;" onclick="validarEntrega()">Solicitar Entrega</button>
      <button class="btn btn-link" onclick="voltarParaPrimeiraTela()">Voltar</button>
    </div>
                    
    <div id="terceiraTela" class="hidden text-left">
      <div class="terceira-tela-header" style="text-align: center; margin-bottom: 20px;">Resumo do Pedido!</div>
      
      <p style="margin-bottom: 5px;">
        <strong>Endereço:</strong> 
        <span id="enderecoTerceiraTela"></span>, 
        <span id="numeroTerceiraTela"></span>
        <span id="complementoTerceiraTela"></span><br>
        <span id="bairroTerceiraTela"></span>, 
        <span id="cidadeTerceiraTela"></span>
        <span id="estadoTerceiraTela"></span>
      </p>
      
      <p style="margin-bottom: 5px;">
        <strong>Ponto de Referência:</strong> <span id="pontoReferenciaTerceiraTela"></span>
      </p>
    
      <div class="form-group mb-3" style="margin-bottom: 10px;">
        <input type="text" class="form-control" id="nomeCliente" placeholder="Nome" required>
      </div>
      
      <div class="form-group mb-3" style="margin-bottom: 10px;">
        <input type="tel" class="form-control" id="telefoneCliente" placeholder="Telefone" required oninput="formatarTelefone(this)">
      </div>
      
      <button class="btn" style="background-color: green; color: white; font-weight: bold; width: 100%;" onclick="finalizarPedido()">Finalizar Pedido</button>
    
      <div style="text-align: center; margin-top: 10px;">
        <button class="btn btn-link" onclick="voltarParaSegundaTela()">Voltar</button>
      </div>
    </div>


    
        
  <script>
    async function buscarCep() {
        const cep = document.getElementById('cep').value.trim().replace("-", "");
        if (!cep || cep.length !== 8 || isNaN(cep)) {
            alert('Por favor, insira um CEP válido com 8 dígitos.');
            return;
        }
    
        if (cepNaoAtendido(cep)) {
            alert('Desculpe, este CEP não é atendido.');
            return;
        }
    
        try {
            const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            if (!response.ok) {
                throw new Error('Erro ao buscar o CEP. Tente novamente mais tarde.');
            }
    
            const data = await response.json();
            if (data.erro) {
                alert('CEP não encontrado.');
                return;
            }
    
            const enderecoFormatado = `${data.logradouro}, ${data.bairro}, ${data.localidade} - ${data.uf}, ${data.cep}`;
            document.getElementById('valorFrete').innerText = calcularFrete(cep)?.valor || "Não disponível";
            document.getElementById('endereco').innerText = enderecoFormatado;
    
            document.getElementById('primeiraTela').classList.add('hidden');
            document.getElementById('segundaTela').classList.remove('hidden');
        } catch (error) {
            alert(`Erro ao consultar o CEP: ${error.message}`);
        }
    }

    function cepNaoAtendido(cep) {
        return cepsNaoAtendidos.includes(cep);
    }

    
    function calcularFrete(cep) {
      for (const frete of tabelaFrete30) {
        if (isCepInRange(cep, frete.cepInicio.replace('-', ''), frete.cepFim.replace('-', ''))) {
          return frete;
        }
      }
      return null;
    }

    function isCepInRange(cep, cepInicio, cepFim) {
      return cep >= cepInicio && cep <= cepFim;
    }

    function abrirFormularioEndereco() {
      const endereco = document.getElementById('endereco').innerText;
      document.getElementById('enderecoTerceiraTela').innerText = endereco;
      document.getElementById('segundaTela').classList.add('hidden');
      document.getElementById('terceiraTela').classList.remove('hidden');
    }

    function abrirFormularioEndereco() {
      const endereco = document.getElementById('endereco').innerText;
      const numero = document.getElementById('numero').value.trim();
      const complemento = document.getElementById('complemento').value.trim();
      const pontoReferencia = document.getElementById('pontoReferencia').value.trim();
    
      document.getElementById('enderecoTerceiraTela').innerText = endereco;
      document.getElementById('numeroTerceiraTela').innerText = numero;
      document.getElementById('complementoTerceiraTela').innerText = complemento || "Não informado";
      document.getElementById('pontoReferenciaTerceiraTela').innerText = pontoReferencia || "Não informado";
    
      document.getElementById('segundaTela').classList.add('hidden');
      document.getElementById('terceiraTela').classList.remove('hidden');
    }

    function formatarTelefone(input) {
      // Remove caracteres que não são dígitos
      let telefone = input.value.replace(/\D/g, '');
    
      // Formata o telefone no padrão (XX) XXXXX-XXXX
      if (telefone.length > 10) {
        telefone = telefone.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
      } else if (telefone.length > 5) {
        telefone = telefone.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
      } else if (telefone.length > 2) {
        telefone = telefone.replace(/(\d{2})(\d{0,5})/, '($1) $2');
      }
    
      input.value = telefone;
    }


    function validarEntrega() {
      const numero = document.getElementById('numero').value.trim();
      const complemento = document.getElementById('complemento').value.trim();
      
      if (!numero) {
        alert('Por favor, informe o número do endereço.');
        return;
      }
    
      const endereco = document.getElementById('endereco').innerText.split(', ');
      const logradouro = endereco[0];
      const bairro = endereco[1] || ""; // Certifique-se de pegar o segundo elemento, que é o bairro
      const cidadeUf = endereco[2].split(' - '); // cidade - uf
      const cidade = cidadeUf[0];
      const estado = cidadeUf[1];
    
      // Montando o texto do complemento, bairro, cidade e estado
      document.getElementById('enderecoTerceiraTela').innerText = logradouro;
      document.getElementById('numeroTerceiraTela').innerText = numero;
      document.getElementById('complementoTerceiraTela').innerText = complemento ? ` - ${complemento}` : "";
      document.getElementById('bairroTerceiraTela').innerText = bairro ? `${bairro}` : ""; // Exibe o bairro
      document.getElementById('cidadeTerceiraTela').innerText = cidade ? `${cidade} -` : ""; // Exibe a cidade
      document.getElementById('estadoTerceiraTela').innerText = estado ? ` ${estado}` : ""; // Exibe o estado
    
      // Preenchendo o ponto de referência
      const pontoReferencia = document.getElementById('pontoReferencia').value.trim() || "Não informado";
      document.getElementById('pontoReferenciaTerceiraTela').innerText = pontoReferencia;
    
      document.getElementById('segundaTela').classList.add('hidden');
      document.getElementById('terceiraTela').classList.remove('hidden');
    }


    function voltarParaPrimeiraTela() {
      document.getElementById('primeiraTela').classList.remove('hidden');
      document.getElementById('segundaTela').classList.add('hidden');
    }

    function voltarParaSegundaTela() {
      document.getElementById('segundaTela').classList.remove('hidden');
      document.getElementById('terceiraTela').classList.add('hidden');
    }

    function toggleComplemento() {
      const complementoInput = document.getElementById('complemento');
      complementoInput.disabled = document.getElementById('semComplemento').checked;
      if (complementoInput.disabled) {
        complementoInput.value = '';
      }
    }

    function formatarCep(input) {
      const cep = input.value.replace(/\D/g, ''); // Remove caracteres não numéricos
      if (cep.length > 5) {
        input.value = `${cep.slice(0, 5)}-${cep.slice(5, 8)}`; // Formata o CEP
      } else {
        input.value = cep; // Retorna o CEP original se menor que 5
      }
    }

    function finalizarPedido() {
      const nomeCliente = document.getElementById('nomeCliente').value.trim();
      const telefoneCliente = document.getElementById('telefoneCliente').value.trim().replace(/\D/g, ''); // Remove todos os caracteres não numéricos
      const cep = document.getElementById('cep').value.trim();
      const valorFrete = document.getElementById('valorFrete').innerText;
    
      if (!nomeCliente || !telefoneCliente) {
        alert('Por favor, preencha todos os campos.');
        return;
      }
    
      if (telefoneCliente.length < 10 || telefoneCliente.length > 11) {
        alert('Por favor, insira um número de telefone válido.');
        return;
      }
    
      const endereco = document.getElementById('enderecoTerceiraTela').innerText;
      const numero = document.getElementById('numeroTerceiraTela').innerText;
      const complemento = document.getElementById('complementoTerceiraTela').innerText;
      const bairro = document.getElementById('bairroTerceiraTela').innerText;
      const cidade = document.getElementById('cidadeTerceiraTela').innerText;
      const estado = document.getElementById('estadoTerceiraTela').innerText;
      const pontoReferencia = document.getElementById('pontoReferenciaTerceiraTela').innerText;
    
      const mensagem = encodeURIComponent(`Olá, sou LOJISTA e gostaria de solicitar uma entrega. \n\n${telefoneCliente}\n${nomeCliente}\n${endereco}, ${numero} ${complemento}\n${bairro}, ${cidade} ${estado}\n${cep}\n${pontoReferencia}\n\nValor do Frete: ${valorFrete}`);
    
      window.open(`https://api.whatsapp.com/send?phone=5521966904641&text=${mensagem}`);
    }

    function enviarMensagemWhatsApp() {
      const mensagem = encodeURIComponent("Olá, preciso de ajuda para encontrar meu CEP.");
      window.open(`https://api.whatsapp.com/send?text=${mensagem}`);
    }
  </script>
    <script type="module">
      import { tabelaFrete30, cepsNaoAtendidos } from './dadosFrete.js';
      
      // Corrigido: expõe com o mesmo nome
      window.tabelaFrete30 = tabelaFrete30;
      window.cepsNaoAtendidos = cepsNaoAtendidos;
    </script>

</body>
</html>
